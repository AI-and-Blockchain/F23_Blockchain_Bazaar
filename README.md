# F23_Blockchain_Bazaar
Blockchain Bazaar is an AI controlled video game item shop. Currently, video game economies typically fall into two categories: player shops and non-player character (NPC) shops. 

In player shops, item prices, quantities, and value are dynamic and change based on free market forces. However, player shops can be plagued by dishonesty and price gouging. In NPC shops, prices are static and non-interactive. Apart from a lack of immersion , the flaw here is that the value of an item is irrelevant if the shops can provide an unlimited supply of it and inevitably cause the inflation of in-game currency.

Blockchain Bazaar aims to take the best of both systems by using blockchain to secure trades and maintain unique items while AI is used to alter prices based on user transactions.

## Team Members
Lorenzo Mercado (mercal)  
Justin Chang (changj11)  
Konain Qureshi (quresk)

## Overview and Diagrams

### Architecture
An architecture diagram showing the components of our system. Metamask is the player's wallet which will be connected to our user interface (transaction API). Prices will be stored on the user interface and AI will be update those prices based on feedback from successful smart contract transactions which will be relayed back to the user interface.

![High-level Diagram for Architecture/Component](./assets/Architecture%20Diagram.png)

### Sequence Diagram
Below is a diagram showing the buy item process.

![High-level Diagram for Architecture/Component](./assets/Sequence%20Diagram.png)

### AI Overview
The AI is going to be used to alter prices for both buying and selling of items within shops based on user transactions
- Utilizing contextual bandits or associative reinforcement learning
    - implemented from a github repository of multiple such algorithms
    - https://github.com/david-cortes/contextualbandits
    - also included is a paper going over each algorithm
    - https://arxiv.org/abs/1811.04383
    - RL suited to dense reward training
    - online model can be constantly trained with each new transaction
    - Implement mainly with numpy and sklearn
- Optimize value generated by balancing sales and purchases through price manipulation
- Update pricing to the UI which can be queried by the oracle

Feature design for AI
- Not every item has all stats, in this case the stat is simply 0
- 0 rarity
- 1 level
- 2 weight
- 3 defense
- 5 damage
- 6 range
- 7 speed

Output design for AI
- Output will be in increments of 20
- taking weights of different arms should allow 100 arms of increments of 20 to output all 1000 values
- keeping the number of arms lower will increase reward density and allow for better training


### Blockchain Overview
A permissionless blockchain to keep single line of truth for transactions as well as unique items in shops. Facilitated through Smart Contracts.
- Permissionless since any player should be able to participate in the market
- Eliminate fraudulent transactions and manipulation of past transactions
- Keep track of unique items and provide a more transparent depiction of the value of the item
- Automate transactions when conditions are met using Smart Contracts

Metamask will be utilized as our playerâ€™s wallets and SepoliaETH as the currency.

## Setup Project
1. Clone repository
2. Navigate to the blockchain folder with `cd blockchain`
3. Install package dependencies with `npm install`

### Frontend
1. Return to root folder then `cd frontend` to navigate to the frontend folder
2. The frontend has different package dependencies so do `npm install` again
3. Start the user interface with `npm start`

### AI
1. Navigate to the ai folder
2. run `pip install -r requirements.txt` 
(contextualbandits may fail to install as current versions do not have pip wheel for windows.
for this reason linux or a version of it such as ubuntu is recommended)

## Testing Plan
The AI will be tested by graphing rewards over training times
There will be two models, one to sell and one to buy, both will be tested at the same time
- Online (batched) testing will use randomly generated data made to reflect item stats
  - One large test (at least 1000 trades)
  - One medium test (under 500 trades)
  - One small test (under 100 trades)
- Online (manual input) testing will be used both to ensure the AI can still gain rewards and to test input
  - Test inputs by giving faulty orders with missing/incorrect information
  - Train for at least 100 trades for buying and 100 for selling
- Online (API integration/client input) used to test connection from API to AI models
  - Test attempting to put in multiple orders for the same item
  - Attempt many valid orders in quick succession

The blockchain will be tested both through the website and outside it
- Non-website tests will be used to test parts before integration
  - Test minting NFT properly randomizes stats
  - Test sale of NFT changes ownership of NFT and transfers funds
  - Test sale of generic item causes token to be burned
- API/website integration tests
  - Attempt sale with improper funds/information to ensure no funds or tokens are transfered
  - Attempt proper sales in quick succession to ensure all sales go through and no mistakes are made
  - Test chain of sales (one client sells to shop and that item is then bought by another client)

The website/API will be tested by multiple clients
- Metamask tests
  - Test metamask connection to website
  - Put in order and ensure correct account is used on blockchain
  - Ensure balance changes are correct after order
- AI integration tests
  - Query model for each type of order (buy, sell, bought, sold)
    - buy and sell should return price values
    - bought and sold should not return anything but instead update the model
  - Run online integration tests for AI (described in ai testing)
- Blockchain integration tests
  - Put in buy/sell orders to the blockchain and ensure transactions go through
  - once transaction goes through ensure the website updates model and changes information (price, quantity etc)
  - Run API integration tests for blockchain (described in blockchain testing)
